<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>联信</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="../css/order_manage/order_common.css">
    <link rel="stylesheet" href="../css/order_manage/order_allocation.css">
    <style>
        .bg-f {
            min-height: 0;
            padding: 1rem;
            padding-top: 3rem;
        }
        #msg_title{
            max-width: 40rem;
        }
        form.form-inline label{
            justify-content: flex-end;
        }
        label[for=msg_content]{
            height: 3rem;
        }
       /* #msg_content{
            height: 28rem!important;
        }*/
        /*.w-e-toolbar{
            padding: .25rem;
        }
		.alert{
            position: fixed;
            left: 58.33%;
            top: 3%;
            width: 82%;
            transform: translate(-50%,-50%);
        }
    </style>
</head>
<body>
<div id="container" class="row  animated fadeIn">
    <!-- 内容 -->
    <div class="main">
        <!--标题-->
        <div class="main-header">
            <ul class="breadcrumb">
                <li class="breadcrumb-item active">
                    <a href="javascript:;">消息管理</a>
                </li>
            </ul>
            <p class="main-title">发布消息</p>
        </div>
        <!-- 发布 -->
        <div class="table-content">
            <div class="bg-f">
                <form class="form-inline" action="">
                    <div class="input-group col-12 mt-2">
                        <label class="control-label col-md-2" for="msg_title">公告标题：</label>
                        <input class="form-control col-md-10 formInput ml-3" id="msg_title" name="msg_title">
                    </div>
                    <div class="input-group col-12 mt-2">
                        <label class="control-label col-md-2" for="msg_content">公告内容：</label>
                        <div class="form-control col-md-8 formInput border-0" id="msg_content"></div>
                    </div>
                    <div class="input-group mt-2 d-block text-center w-100">
                        <input type="submit" class="btn btn-primary" value="确认发布">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="${BASE_PATH }static/credit/assets/wangEditor-3.1.1/release/wangEditor.min.js"></script>
<script>
    $(function () {
        let E = wangEditor;
        let editor = new E('#msg_content');
        //editor.customConfig.uploadImgShowBase64 = true   // 使用 base64 保存图片
        editor.customConfig.uploadImgServer = '/credit/sysuser/notice/imgUpload'  // 上传图片到服务器
        editor.customConfig.uploadFileName = 'file';
        editor.create();
         $("[type=submit]").click(function () {
        	 let title=$("#msg_title").val()
        	 if(title===""){
        		 Public.message("error","请填写公告标题");
        		 return false;
 			 }
             // 读取 text
             let content=editor.txt.html();
             var json = editor.txt.getJSON()  // 获取 JSON 格式的内容
             var jsonStr = JSON.stringify(json)
             save(title,content);
             return false;
        })
    })
    //发布公告
	function save(title,content){
		$.ajax({
   			type:"post",
       		url:"/credit/sysuser/notice/save",
       		data:"model.notice_content="+encodeURI(content)+"&model.notice_title="+title,
       		dataType:"json",
       		success:function(data){
       			if(data.statusCode===1){
       				Public.message("success",data.message);
       				location.reload(); 
       			}else{
       				Public.message("error",data.message);
       			}
   			 }
			})
		
	}
</script>
</body>
</html>
